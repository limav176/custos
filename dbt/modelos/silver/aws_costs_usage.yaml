version: 2

models:
  - name: aws_costs_usage
    description: >
      **Propósito:** Isolar e apresentar os custos de uso direto da AWS que são diretamente atribuíveis a um time (`circle_id`), servindo como a principal fonte para análises de responsabilidade de custos (chargeback).
      **Escopo:** Inclui apenas custos de uso que possuem um `circle_id` válido e atribuído. Exclui sistematicamente todos os custos que não representam uso direto ou que não podem ser atribuídos, como custos de Marketplace, Support, Shared e Untagged.
      **Audiência:** Analistas de Negócios, Cientistas de Dados, Tech Leads e times de engenharia.
      **Processo:** Os dados são derivados de `silver_aws_cost_usage_report` e enriquecidos com dados de `holaspirit_circles` via `LEFT JOIN` no `circle_id`. O modelo funciona por um processo de exclusão em cascata, removendo todas as categorias de custo (Marketplace, Support, etc.) para, ao final, filtrar apenas os registros que possuem um `circle_id` válido.
      **Recorrência de atualização:** Diária.
    meta:
      domain: custos_cloud
      layer: silver
      schema: custos_cloud_silver
      owner: observability-platform@willbank.com.br
      openmetadata:
        tags: ['classificacao_da_informacao.publico']
        tier: 'Tier.Tier2'

    tags:
      - "camada:silver"
      - "dominio:custos_cloud"
      - "provedor:aws"
      - "tipo_de_custo:usage"
      - "logica:filtragem"
      - "tabela_fonte:silver_aws_cost_usage_report"

    columns:
      - name: start_date
        description: "Data de início do período de uso do custo. Copiado diretamente da coluna `start_date` da tabela `silver_aws_cost_usage_report`."
      - name: resource_id
        description: "Identificador único do recurso na AWS. Copiado diretamente da coluna `resource_id` da tabela `silver_aws_cost_usage_report`."
      - name: description
        description: "Descrição do item de linha de faturamento. Copiado diretamente da coluna `description` da tabela `silver_aws_cost_usage_report`."
      - name: billing_origin
        description: "Origem da cobrança (ex. 'EC2', 'S3'). Copiado diretamente da coluna `billing_origin` da tabela `silver_aws_cost_usage_report`."
      - name: aws_product_name
        description: "Nome do produto da AWS. Copiado diretamente da coluna `aws_product_name` da tabela `silver_aws_cost_usage_report`."
      - name: circle_id
        description: "Identificador do Círculo (time) associado ao custo. Copiado diretamente da coluna `circle_id` da tabela `silver_aws_cost_usage_report`. Nesta tabela, este campo sempre contém um valor válido."
      - name: providedby_id
        description: "Identificador do provedor do Círculo. Copiado diretamente da coluna `providedby_id` da tabela `silver_aws_cost_usage_report`."
      - name: circle_type
        description: "Tipo do Círculo (ex. 'Squad', 'Chapter'). Derivado da tabela `holaspirit_circles` através de um `JOIN` com a coluna `circle_id`."
      - name: tag_repository
        description: "Tag de repositório associada ao recurso. Copiado diretamente da coluna `tag_repository` da tabela `silver_aws_cost_usage_report`."
      - name: tag_product
        description: "Tag de produto associada ao recurso. Copiado diretamente da coluna `tag_product` da tabela `silver_aws_cost_usage_report`."
      - name: tag_management
        description: "Tag de gerenciamento associada ao recurso. Copiado diretamente da coluna `tag_management` da tabela `silver_aws_cost_usage_report`."
      - name: tag_name
        description: "Tag de nome (`Name`) associada ao recurso. Copiado diretamente da coluna `tag_name` da tabela `silver_aws_cost_usage_report`."
      - name: tag_policy_compliant
        description: "Indica se o recurso está em conformidade com a política de tagueamento. Copiado diretamente da coluna `tag_policy_compliant` da tabela `silver_aws_cost_usage_report`."
      - name: tag_policy_compliant_actual
        description: "Indica a conformidade de tagueamento no momento do uso. Copiado diretamente da coluna `tag_policy_compliant_actual` da tabela `silver_aws_cost_usage_report`."
      - name: environment
        description: "Ambiente ao qual o recurso pertence (ex. 'production'). Copiado diretamente da coluna `environment` da tabela `silver_aws_cost_usage_report`."
      - name: usage_type
        description: "Tipo de uso do recurso faturado. Copiado diretamente da coluna `usage_type` da tabela `silver_aws_cost_usage_report`."
      - name: engine
        description: "Motor de banco de dados, se aplicável. Copiado diretamente da coluna `engine` da tabela `silver_aws_cost_usage_report`."
      - name: instance_type
        description: "Tipo da instância de computação (ex. 't2.micro'). Copiado diretamente da coluna `instance_type` da tabela `silver_aws_cost_usage_report`."
      - name: pricing_term
        description: "Termo de precificação (ex. 'OnDemand'). Copiado diretamente da coluna `pricing_term` da tabela `silver_aws_cost_usage_report`."
      - name: account_id
        description: "ID da conta da AWS. Copiado diretamente da coluna `account_id` da tabela `silver_aws_cost_usage_report`."
      - name: account_name
        description: "Nome da conta da AWS. Copiado diretamente da coluna `account_name` da tabela `silver_aws_cost_usage_report`."
      - name: region
        description: "Região da AWS onde o recurso foi provisionado. Copiado diretamente da coluna `region` da tabela `silver_aws_cost_usage_report`."
      - name: unblended_cost
        description: "Custo bruto do recurso, sem a aplicação de descontos ou créditos. Copiado diretamente da coluna `unblended_cost` da tabela `silver_aws_cost_usage_report`."
      - name: reservation_cost
        description: "Custo associado a instâncias reservadas. Copiado diretamente da coluna `reservation_cost` da tabela `silver_aws_cost_usage_report`."
