version: 2

models:
  - name: aws_costs_day_untagged
    meta:
      domain: custos_cloud
      layer: gold
      schema: custos_cloud_gold
      owner: observability-platform@willbank.com.br
      openmetadata:
        tags: [
          'classificacao_da_informacao.publico'
        ]
        tier: 'Tier.Tier2'

    description: |
      **Propósito:** Consolidar e agregar diariamente todos os custos da AWS que não puderam ser associados a um Círculo (`circle_id`) específico durante o processo de tagueamento na camada Silver.
      **Escopo:** Inclui todos os custos da tabela `silver.aws_costs_untagged`. A granularidade dos dados é agregada em nível diário, e a query soma os custos de reserva (`reservation_cost`) e os custos não combinados (`unblended_cost`).
      **Audiência:** Engenheiros de FinOps e líderes de plataforma, para identificar e analisar fontes de custos que não estão sendo corretamente rastreadas e atribuídas aos times.
      **Processo:** Os dados são derivados diretamente da tabela `silver.aws_costs_untagged`. A query agrupa (`GROUP BY`) os custos por todas as dimensões disponíveis, como recurso, produto e conta, e trunca a data para o nível diário (`DATE_TRUNC('day', ...)`), calculando a soma dos custos para cada grupo.
      **Recorrência de atualização:** Diária.

    tags: [gold, will, custos_cloud]

    columns:
      - name: start_date
        description: "Data de início do período de uso do recurso, agregada em nível diário. Calculado como `DATE_TRUNC('day', CAST(start_date AS TIMESTAMP))` a partir da fonte `aws_costs_untagged`."
      - name: resource_id
        description: "ID único do recurso da AWS que gerou o custo. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: description
        description: "Descrição do item de linha de custo, fornecida pela AWS. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: billing_origin
        description: "Origem dos dados de faturamento (ex. 'custos_aws_billing'). Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: aws_product_name
        description: "Nome do produto da AWS ao qual o custo está associado (ex. 'AmazonEC2', 'AmazonS3'). Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: circle_id
        description: "ID do círculo associado. Nesta tabela, este campo conterá valores que indicam que o custo não foi atribuído a um círculo específico. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: providedby_id
        description: "ID do provedor do círculo. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: circle_type
        description: "Tipo do círculo (ex. 'stream-aligned', 'platform'). Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: tag_repository
        description: "Valor extraído da tag 'repository' do recurso, se disponível. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: tag_product
        description: "Valor extraído da tag 'product' do recurso, se disponível. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: tag_management
        description: "Valor extraído da tag 'management' do recurso, se disponível. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: tag_name
        description: "Valor extraído da tag 'name' do recurso, se disponível. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: tag_policy_compliant
        description: "Indicador booleano que sinaliza se o recurso atende à política de tagueamento definida. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: tag_policy_compliant_actual
        description: "Indicador booleano que reflete a conformidade de tagueamento no momento exato do uso. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: environment
        description: "Ambiente associado ao recurso (ex. 'production', 'development'). Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: usage_type
        description: "Descrição do tipo de uso específico do serviço da AWS (ex. 'DataTransfer-Out-Bytes'). Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: pricing_term
        description: "Termo de precificação para o uso (ex. 'OnDemand', 'Reserved'). Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: account_id
        description: "ID da conta da AWS onde o custo foi gerado. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: account_name
        description: "Nome legível da conta da AWS. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: region
        description: "Região da AWS onde o recurso foi provisionado. Proveniente diretamente da tabela `aws_costs_untagged`."
      - name: reservation_cost
        description: "Custo diário agregado associado a instâncias reservadas. Calculado como `SUM(reservation_cost)` sobre os dados da fonte."
      - name: unblended_cost
        description: "Custo diário agregado não combinado (taxa bruta da AWS, sem descontos). Calculado como `SUM(unblended_cost)` sobre os dados da fonte."
